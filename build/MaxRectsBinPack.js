!function(){function t(t,e,i,h){this.x=t||0,this.y=e||0,this.width=i||0,this.height=h||0}function e(t,e,i){this.binWidth=0,this.binHeight=0,this.allowRotate=!1,this.usedRectangles=[],this.freeRectangles=[],this.init(t,e,i)}t.prototype={constructor:t,clone:function(){return new t(this.x,this.y,this.width,this.height)}},t.isContainedIn=function(t,e){return t.x>=e.x&&t.y>=e.y&&t.x+t.width<=e.x+e.width&&t.y+t.height<=e.y+e.height};var i=0,h=1,a=2,n=3,o=4;e.prototype={constructor:e,init:function(e,i,h){this.binWidth=e,this.binHeight=i,this.allowRotate=h||!1,this.usedRectangles.length=0,this.freeRectangles.length=0,this.freeRectangles.push(new t(0,0,e,i))},insert:function(e,s,r){var l=new t,u={value:0},d={value:0};switch(r=r||0){case i:l=this._findPositionForNewNodeBestShortSideFit(e,s,u,d);break;case n:l=this._findPositionForNewNodeBottomLeft(e,s,u,d);break;case o:l=this._findPositionForNewNodeContactPoint(e,s,u);break;case h:l=this._findPositionForNewNodeBestLongSideFit(e,s,d,u);break;case a:l=this._findPositionForNewNodeBestAreaFit(e,s,u,d)}return 0===l.height?l:(this._placeRectangle(l),l)},insert2:function(e,i){for(var h=[];e.length>0;){for(var a=1/0,n=1/0,o=-1,s=new t,r=0;r<e.length;r++){var l={value:0},u={value:0},d=this._scoreRectangle(e[r].width,e[r].height,i,l,u);(l.value<a||l.value==a&&u.value<n)&&(a=l.value,n=u.value,s=d,o=r)}if(-1==o)return h;this._placeRectangle(s);var g=e.splice(o,1)[0];g.x=s.x,g.y=s.y,h.push(g)}return h},_placeRectangle:function(t){for(var e=this.freeRectangles.length,i=0;e>i;i++)this._splitFreeNode(this.freeRectangles[i],t)&&(this.freeRectangles.splice(i,1),i--,e--);this._pruneFreeList(),this.usedRectangles.push(t)},_scoreRectangle:function(e,s,r,l,u){var d=new t;switch(l.value=1/0,u.value=1/0,r){case i:d=this._findPositionForNewNodeBestShortSideFit(e,s,l,u);break;case n:d=this._findPositionForNewNodeBottomLeft(e,s,l,u);break;case o:d=this._findPositionForNewNodeContactPoint(e,s,l),l=-l;break;case h:d=this._findPositionForNewNodeBestLongSideFit(e,s,u,l);break;case a:d=this._findPositionForNewNodeBestAreaFit(e,s,l,u)}return 0===d.height&&(l.value=1/0,u.value=1/0),d},_occupancy:function(){for(var t=this.usedRectangles,e=0,i=0;i<t.length;i++)e+=t[i].width*t[i].height;return e/(this.binWidth*this.binHeight)},_findPositionForNewNodeBottomLeft:function(e,i,h,a){var n=this.freeRectangles,o=new t;h.value=1/0;for(var s,r,l=0;l<n.length;l++)s=n[l],s.width>=e&&s.height>=i&&(r=s.y+i,(r<h.value||r==h.value&&s.x<a.value)&&(o.x=s.x,o.y=s.y,o.width=e,o.height=i,h.value=r,a.value=s.x)),this.allowRotate&&s.width>=i&&s.height>=e&&(r=s.y+e,(r<h.value||r==h.value&&s.x<a.value)&&(o.x=s.x,o.y=s.y,o.width=i,o.height=e,h.value=r,a.value=s.x));return o},_findPositionForNewNodeBestShortSideFit:function(e,i,h,a){var n=this.freeRectangles,o=new t;h.value=1/0;for(var s,r,l,u,d,g=0;g<n.length;g++){s=n[g],s.width>=e&&s.height>=i&&(r=Math.abs(s.width-e),l=Math.abs(s.height-i),u=Math.min(r,l),d=Math.max(r,l),(u<h.value||u==h.value&&d<a.value)&&(o.x=s.x,o.y=s.y,o.width=e,o.height=i,h.value=u,a.value=d));var c,v,w,f;this.allowRotate&&s.width>=i&&s.height>=e&&(c=Math.abs(s.width-i),v=Math.abs(s.height-e),w=Math.min(c,v),f=Math.max(c,v),(w<h.value||w==h.value&&f<a.value)&&(o.x=s.x,o.y=s.y,o.width=i,o.height=e,h.value=w,a.value=f))}return o},_findPositionForNewNodeBestLongSideFit:function(e,i,h,a){var n=this.freeRectangles,o=new t;a.value=1/0;for(var s,r,l,u,d,g=0;g<n.length;g++)s=n[g],s.width>=e&&s.height>=i&&(r=Math.abs(s.width-e),l=Math.abs(s.height-i),u=Math.min(r,l),d=Math.max(r,l),(d<a.value||d==a.value&&u<h.value)&&(o.x=s.x,o.y=s.y,o.width=e,o.height=i,h.value=u,a.value=d)),this.allowRotate&&s.width>=i&&s.height>=e&&(r=Math.abs(s.width-i),l=Math.abs(s.height-e),u=Math.min(r,l),d=Math.max(r,l),(d<a.value||d==a.value&&u<h.value)&&(o.x=s.x,o.y=s.y,o.width=i,o.height=e,h.value=u,a.value=d));return o},_findPositionForNewNodeBestAreaFit:function(e,i,h,a){var n=this.freeRectangles,o=new t;h.value=1/0;for(var s,r,l,u,d,g=0;g<n.length;g++)s=n[g],d=s.width*s.height-e*i,s.width>=e&&s.height>=i&&(r=Math.abs(s.width-e),l=Math.abs(s.height-i),u=Math.min(r,l),(d<h.value||d==h.value&&u<a.value)&&(o.x=s.x,o.y=s.y,o.width=e,o.height=i,a.value=u,h=d)),this.allowRotate&&s.width>=i&&s.height>=e&&(r=Math.abs(s.width-i),l=Math.abs(s.height-e),u=Math.min(r,l),(d<h.value||d==h.value&&u<a.value)&&(o.x=s.x,o.y=s.y,o.width=i,o.height=e,a.value=u,h.value=d));return o},_commonIntervalLength:function(t,e,i,h){return i>e||t>h?0:Math.min(e,h)-Math.max(t,i)},_contactPointScoreNode:function(t,e,i,h){var a=this.usedRectangles,n=0;(0==t||t+i===this.binWidth)&&(n+=h),(0==e||e+h===this.binHeight)&&(n+=i);for(var o,s=0;s<a.length;s++)o=a[s],(o.x==t+i||o.x+o.width==t)&&(n+=this._commonIntervalLength(o.y,o.y+o.height,e,e+h)),(o.y==e+h||o.y+o.height==e)&&(n+=this._commonIntervalLength(o.x,o.x+o.width,t,t+i));return n},_findPositionForNewNodeContactPoint:function(e,i,h){var a=this.freeRectangles,n=new t;h.value=-1;for(var o,s,r=0;r<a.length;r++)o=a[r],o.width>=e&&o.height>=i&&(s=this._contactPointScoreNode(o.x,o.y,e,i),s>h.value&&(n.x=o.x,n.y=o.y,n.width=e,n.height=i,h=s)),this.allowRotate&&o.width>=i&&o.height>=e&&(s=this._contactPointScoreNode(o.x,o.y,i,e),s>h.value&&(n.x=o.x,n.y=o.y,n.width=i,n.height=e,h.value=s));return n},_splitFreeNode:function(t,e){var i=this.freeRectangles;if(e.x>=t.x+t.width||e.x+e.width<=t.x||e.y>=t.y+t.height||e.y+e.height<=t.y)return!1;var h;return e.x<t.x+t.width&&e.x+e.width>t.x&&(e.y>t.y&&e.y<t.y+t.height&&(h=t.clone(),h.height=e.y-h.y,i.push(h)),e.y+e.height<t.y+t.height&&(h=t.clone(),h.y=e.y+e.height,h.height=t.y+t.height-(e.y+e.height),i.push(h))),e.y<t.y+t.height&&e.y+e.height>t.y&&(e.x>t.x&&e.x<t.x+t.width&&(h=t.clone(),h.width=e.x-h.x,i.push(h)),e.x+e.width<t.x+t.width&&(h=t.clone(),h.x=e.x+e.width,h.width=t.x+t.width-(e.x+e.width),i.push(h))),!0},_pruneFreeList:function(){for(var e=this.freeRectangles,i=0;i<e.length;i++)for(var h=i+1;h<e.length;h++){if(t.isContainedIn(e[i],e[h])){e.splice(i,1);break}t.isContainedIn(e[h],e[i])&&e.splice(h,1)}}},window.MaxRectsBinPack=e}();